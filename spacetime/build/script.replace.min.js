m=(a,b,c,d)=>((Math.atan2(d-b,c-a))*180/Math.PI),n=(c,d,a,b)=>(Math.sqrt((a-=c)*a+(b-=d)*b)),o=(a,b)=>((Math.cos(b*Math.PI/180))*a),p=(a,b)=>((Math.sin(b*Math.PI/180))*a),aq=a=>{ar=a.getCTM(),as=[];for(let b=0;b<a.points.length;b++)as.push(a.points[b].matrixTransform(ar));return as},an=(a,b,c,e)=>{let g=[];let i=(e.x-c.x)*(a.y-c.y)-(e.y-c.y)*(a.x-c.x);let j=(b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x);let f=(e.y-c.y)*(b.x-a.x)-(e.x-c.x)*(b.y-a.y);if(f!=0){let d=i/f;let h=j/f;0<=d&&d<=1&&0<=h&&h<=1&&(console.log(a.x+d*(b.x-a.x),a.y+d*(b.y-a.y)),g.push([a.x+d*(b.x-a.x),a.y+d*(b.y-a.y)]))}return g},ao=(c,d,a)=>{let b=[];for(let e=0;e<a.length;e++)b=b.concat(an(c,d,a[e],a[(e+1)%a.length]));return b},ap=(a,c)=>{let b=[];for(let d=0;d<a.length;d++)b=b.concat(ao(a[d],a[(d+1)%a.length],c));return b},controlUpdate=a=>{let b=navigator.getGamepads();if(!b[a])return;if(b[a].buttons[0].pressed&&(players[a].shoot=!0),players[a].glitch--,b[a].buttons[2].pressed&&players[a].glitch<0){players[a].glitch=players[a].glitchTime,players[a].x+=Math.random()*200-100,players[a].y+=Math.random()*200-100;let c=boatWrapper.cloneNode(!0);c.id='',topLayer.appendChild(c),glitches.push({c:c,b:c.children[0],glitchLog:players[a].glitchLog}),players[a].glitchLog=[]}players[a].glitchLog.push([players[a].x,players[a].y,players[a].d]),b[a].buttons[7].value>.2&&players[a].e<b[a].buttons[7].value*players[a].f?players[a].e=Math.min(players[a].e+b[a].buttons[7].value*players[a].l,players[a].f):players[a].e/=players[a].friction,b[a].axes[0]>.3||b[a].axes[0]<-.3?players[a].g=Math.round(b[a].axes[0]*players[a].h):players[a].g/=players[a].turnFriction},a=(a,b,c)=>{a.transform.baseVal[0].matrix.e=b,a.transform.baseVal[0].matrix.f=c},b=(a,b,c,d)=>{a.transform.baseVal[1].setRotate(b,c,d)},players=[],glitches=[],createPlayer=()=>{let a=boatWrapper.cloneNode(!0);a.id='',topLayer.appendChild(a),players.push({c:a,b:a.children[0],z:16,aa:4,x:500,y:500,d:0,e:0,f:10,l:.4,friction:1.1,g:0,h:5,k:.5,turnFriction:1.2,shoot:!1,af:0,ag:10,glitch:0,glitchTime:30,glitchLog:[]})},createPlayer(),createPlayer(),bullets=[],ac=[],ad={ae:bubbleParticle,af:0,ag:1,ah:1},bubbleParticleAnimation=a=>{a.c.style.opacity-=.01},moveGameObjects=c=>{for(let d=0;d<c.length;d++)c[d].x+=o(c[d].e,c[d].d),c[d].y+=p(c[d].e,c[d].d),a(c[d].c,c[d].x,c[d].y),b(c[d].b,c[d].d,c[d].z,c[d].aa)},createExplosion=(a,b)=>{for(let c=0;c<16;c++)explosionClone=explosion.cloneNode(!0),explosionClone.id='',explosionClone.style.fill=['#FD6D0A','#FE9923','#FFDE03','#fff'][Math.floor(c/4)],topLayer.appendChild(explosionClone),ac.push({x:a+(Math.random()*10-5),y:b+(Math.random()*10-5),c:explosionClone,life:5e3,e:Math.random()/2,d:Math.random()*360,animationState:0,animationSpeed:Math.random()*2+5,animate:a=>{a.animationState+=a.animationSpeed,a.c.r.baseVal.value=-(Math.cos(a.animationState*(Math.PI/100))-1)*5,a.c.style.opacity-=.02,a.animationState>200&&(a.life=0)}})},s=()=>{for(let a=0;a<players.length;a++){controlUpdate(a),players[a].d+=players[a].g;while(players[a].d>360)players[a].d-=360;while(players[a].d<0)players[a].d+=360;if(ad.af--,ad.af<0&&players[a].e>.1){ad.af=ad.ag;for(let a=0;a<ad.ah;a++)ak=ad.ae.cloneNode(!0),ak.id='',bottomLayer.appendChild(ak),ac.push({x:players[a].x+(Math.random()*4-2),y:players[a].y+(Math.random()*4-2),c:ak,life:30,e:players[a].e/10,d:players[a].d-180+(Math.random()*30-15),animate:bubbleParticleAnimation})}players[a].af--,players[a].shoot&&players[a].af<0&&(players[a].af=players[a].ag,am=bullet.cloneNode(!0),am.id='',topLayer.appendChild(am),bullets.push({owner:a,c:am,b:am,z:0,aa:0,x:players[a].x,y:players[a].y,d:players[a].d,e:20,life:200})),players[a].shoot=!1}for(let c=0;c<glitches.length;c++)glitches[c].glitchLog[0]&&(a(glitches[c].c,glitches[c].glitchLog[0][0],glitches[c].glitchLog[0][1]),b(glitches[c].b,glitches[c].glitchLog[0][2],16,4)),glitches[c].glitchLog.shift()||(glitches[c].c.remove(),glitches.splice(c,1));moveGameObjects(players),moveGameObjects(bullets);a:for(let a=0;a<bullets.length;a++){for(let b=0;b<players.length;b++){if(bullets[a].owner==b)continue;if(collisionDistance=n(bullets[a].x,bullets[a].y,players[b].x,players[b].y),collisionDistance<20){createExplosion(bullets[a].x,bullets[a].y),bullets[a].c.remove(),bullets.splice(a,1),b=players.length;continue a}}bullets[a].life--,bullets[a].life<0&&(createExplosion(bullets[a].x,bullets[a].y),bullets[a].c.remove(),bullets.splice(a,1))}for(let b=0;b<ac.length;b++)ac[b].x+=o(ac[b].e,ac[b].d),ac[b].y+=p(ac[b].e,ac[b].d),ac[b].animate(ac[b]),a(ac[b].c,ac[b].x,ac[b].y),ac[b].life--,ac[b].life<0&&(ac[b].c.remove(),ac.splice(b,1));svgNode.viewBox.baseVal.x=players[0].x-window.innerWidth/2,svgNode.viewBox.baseVal.y=players[0].y-window.innerHeight/2,svgNode.viewBox.baseVal.width=window.innerWidth,svgNode.viewBox.baseVal.height=window.innerHeight,requestAnimationFrame(s)},s(),window.addEventListener('gamepadconnected',a=>{controllers=navigator.getGamepads()},!1),window.addEventListener('gamepaddisconnected',a=>{controllers=navigator.getGamepads()},!1)