function SfxrParams(){this.setSettings=function(c){for(let d=0;d<24;d++)this[String.fromCharCode(97+d)]=c[d]||0;this.c<.01&&(this.c=.01);let b=this.b+this.c+this.e;if(b<.18){let a=.18/b;this.b*=a,this.c*=a,this.e*=a}}}function SfxrSynth(){this._params=new SfxrParams;let e,c,d,b,h,g,l,i,j,f,a,k;this.reset=function(){let c=this._params;b=100/(c.f*c.f+.001),h=100/(c.g*c.g+.001),g=1-c.h*c.h*c.h*.01,l=-c.i*c.i*c.i*1e-6,c.a||(a=.5-c.n/2,k=-c.o*5e-5),i=1+c.l*c.l*(c.l>0?-.9:10),j=0,f=c.m==1?0:(1-c.m)*(1-c.m)*2e4+32},this.totalReset=function(){this.reset();let a=this._params;return e=a.b*a.b*1e5,c=a.c*a.c*1e5,d=a.e*a.e*1e5+12,((e+c+d)/3|0)*3},this.synthWave=function(a0,U){let m=this._params;let N=m.s!=1||m.v,t=m.v*m.v*.1,L=1+m.w*3e-4,q=m.s*m.s*m.s*.1,Y=1+m.t*1e-4,_=m.s!=1,Q=m.x*m.x,S=m.g,O=m.q||m.r,W=m.r*m.r*m.r*.2,H=m.q*m.q*(m.q<0?-1020:1020),I=m.p?((1-m.p)*(1-m.p)*2e4|0)+32:0,Z=m.d,J=m.j/2,$=m.k*m.k*.01,G=m.a;let F=e,T=1/e,X=1/c,V=1/d;let x=5/(1+m.u*m.u*20)*(.01+q);x>.8&&(x=.8),x=1-x;let D=!1,P=0,v=0,u=0,C=0,A=0,R,y=0,o,r=0,s,E=0,p,M=0,n,z,K=0;let B=new Array(1024),w=new Array(32);for(let a=B.length;a--;)B[a]=0;for(let a=w.length;a--;)w[a]=Math.random()*2-1;for(let e=0;e<U;e++){if(D)return e;if(I&&++M>=I&&(M=0,this.reset()),f&&++j>=f&&(f=0,b*=i),g+=l,b*=g,b>h&&(b=h,S>0&&(D=!0)),o=b,J>0&&(K+=$,o*=1+Math.sin(K)*J),o|=0,o<8&&(o=8),G||(a+=k,a<0?a=0:a>.5&&(a=.5)),++v>F){v=0;switch(++P){case 1:F=c;break;case 2:F=d}}switch(P){case 0:u=v*T;break;case 1:u=1+(1-v*X)*2*Z;break;case 2:u=1-v*V;break;case 3:u=0;D=!0}O&&(H+=W,s=H|0,s<0?s=-s:s>1023&&(s=1023)),N&&L&&(t*=L,t<1e-5?t=1e-5:t>.1&&(t=.1)),z=0;for(let b=8;b--;){if(r++,r>=o&&(r%=o,G==3))for(let a=w.length;a--;)w[a]=Math.random()*2-1;switch(G){case 0:n=r/o<a?.5:-.5;break;case 1:n=1-r/o*2;break;case 2:p=r/o;p=(p>.5?p-1:p)*6.28318531;n=1.27323954*p+.405284735*p*p*(p<0?1:-1);n=.225*((n<0?-1:1)*n*n-n)+n;break;case 3:n=w[Math.abs(r*32/o|0)]}N&&(R=y,q*=Y,q<0?q=0:q>.1&&(q=.1),_?(A+=(n-y)*q,A*=x):(y=n,A=0),y+=A,C+=y-R,C*=1-t,n=C),O&&(B[E%1024]=n,n+=B[(E-s+1024)%1024],E++),z+=n}z*=.125*u*Q,a0[e]=z>=1?32767:z<=-1?-32768:z*32767|0}return U}}let synth=new SfxrSynth;let jsfxr=function(i){synth._params.setSettings(i);let g=synth.totalReset();let b=new Uint8Array(((g+1)/2|0)*4+44);let d=synth.synthWave(new Uint16Array(b.buffer,44),g)*2;let a=new Uint32Array(b.buffer,0,44);a[0]=1179011410,a[1]=d+36,a[2]=1163280727,a[3]=544501094,a[4]=16,a[5]=65537,a[6]=44100,a[7]=88200,a[8]=1048578,a[9]=1635017060,a[10]=d,d+=44;let c=0,e='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',h='data:audio/wav;base64,';for(;c<d;c+=3){let f=b[c]<<16|b[c+1]<<8|b[c+2];h+=e[f>>18]+e[f>>12&63]+e[f>>6&63]+e[f&63]}return h};createSound=b=>{let a=[];for(let c=0;c<10;c++){let e=jsfxr(b);let d=new Audio;d.src=e,a.push(d)}return a},playSound=(b,c,d)=>{let a=2e3;for(let e=0;e<panes.length;e++){let f=n(panes[e].viewBox.baseVal.x+window.innerWidth*zoom/2,panes[e].viewBox.baseVal.y+window.innerHeight*zoom/2,c,d);f<a&&(a=f)}a<2e3&&(w=b.shift(),w.volume=-(5e-4*a)+1,w.play(),b.push(w))},soundGenerator=(()=>{defaultSynth={waveType:0,startFrequency:.3,minFrequency:0,slide:0,deltaSlide:0,squareDuty:0,dutySweep:0,vibratoDepth:0,vibratoSpeed:0,attackTime:0,sustainTime:.3,decayTime:.4,sustainPunch:0,lpFilterResonance:0,lpFilterCutoff:1,lpFilterCutoffSweep:0,hpFilterCutoff:0,hpFilterCutoffSweep:0,phaserOffset:0,phaserSweep:0,repeatSpeed:0,changeSpeed:0,changeAmount:0};let a=a=>[a.waveType,a.attackTime,a.sustainTime,a.sustainPunch,a.decayTime,a.startFrequency,a.minFrequency,a.slide,a.deltaSlide,a.vibratoDepth,a.vibratoSpeed,a.changeAmount,a.changeSpeed,a.squareDuty,a.dutySweep,a.repeatSpeed,a.phaserOffset,a.phaserSweep,a.lpFilterCutoff,a.lpFilterCutoffSweep,a.lpFilterResonance,a.hpFilterCutoff,a.hpFilterCutoffSweep,.5];return{generatePickupCoin:()=>{let b=Object.assign({},defaultSynth);return b.startFrequency=.4+Math.random()*.5,b.sustainTime=Math.random()*.1,b.decayTime=.1+Math.random()*.4,b.sustainPunch=.3+Math.random()*.3,Math.random()<.5&&(b.changeSpeed=.5+Math.random()*.2,b.changeAmount=.2+Math.random()*.4),a(b)},generateLaserShoot:()=>{let b=Object.assign({},defaultSynth);return b.waveType=Math.floor(Math.random()*3),b.waveType==2&&Math.random()<.5&&(b.waveType=Math.floor(Math.random()*2)),b.startFrequency=.5+Math.random()*.5,b.minFrequency=b.startFrequency-.2-Math.random()*.6,b.minFrequency<.2&&(b.minFrequency=.2),b.slide=-.15-Math.random()*.2,Math.random()<.33&&(b.startFrequency=.3+Math.random()*.6,b.minFrequency=Math.random()*.1,b.slide=-.35-Math.random()*.3),Math.random()<.5?(b.squareDuty=Math.random()*.5,b.dutySweep=Math.random()*.2):(b.squareDuty=.4+Math.random()*.5,b.dutySweep=-Math.random()*.7),b.sustainTime=.1+Math.random()*.2,b.decayTime=Math.random()*.4,Math.random()<.5&&(b.sustainPunch=Math.random()*.3),Math.random()<.33&&(b.phaserOffset=Math.random()*.2,b.phaserSweep=-Math.random()*.2),Math.random()<.5&&(b.hpFilterCutoff=Math.random()*.3),a(b)},generateExplosion:()=>{let b=Object.assign({},defaultSynth);return b.waveType=3,Math.random()<.5?(b.startFrequency=.1+Math.random()*.4,b.slide=-.1+Math.random()*.4):(b.startFrequency=.2+Math.random()*.7,b.slide=-.2-Math.random()*.2),b.startFrequency*=b.startFrequency,Math.random()<.2&&(b.slide=0),Math.random()<.33&&(b.repeatSpeed=.3+Math.random()*.5),b.sustainTime=.1+Math.random()*.3,b.decayTime=Math.random()*.5,b.sustainPunch=.2+Math.random()*.6,Math.random()<.5&&(b.phaserOffset=-.3+Math.random()*.9,b.phaserSweep=-Math.random()*.3),Math.random()<.33&&(b.changeSpeed=.6+Math.random()*.3,b.changeAmount=.8-Math.random()*1.6),a(b)},generatePowerup:()=>{let b=Object.assign({},defaultSynth);return Math.random()<.5?b.waveType=1:b.squareDuty=Math.random()*.6,Math.random()<.5?(b.startFrequency=.2+Math.random()*.3,b.slide=.1+Math.random()*.4,b.repeatSpeed=.4+Math.random()*.4):(b.startFrequency=.2+Math.random()*.3,b.slide=5+Math.random()*.2,Math.random()<.5&&(b.vibratoDepth=Math.random()*.7,b.vibratoSpeed=Math.random()*.6)),b.sustainTime=Math.random()*.4,b.decayTime=.1+Math.random()*.4,a(b)},generateHitHurt:()=>{let b=Object.assign({},defaultSynth);return b.waveType=Math.floor(Math.random()*3),b.waveType==2?b.waveType=3:b.waveType==0&&(b.squareDuty=Math.random()*.6),b.startFrequency=.2+Math.random()*.6,b.slide=-.3-Math.random()*.4,b.sustainTime=Math.random()*.1,b.decayTime=.1+Math.random()*.2,Math.random()<.5&&(b.hpFilterCutoff=Math.random()*.3),a(b)},generateJump:()=>{let b=Object.assign({},defaultSynth);return b.waveType=0,b.squareDuty=Math.random()*.6,b.startFrequency=.3+Math.random()*.3,b.slide=.1+Math.random()*.2,b.sustainTime=.1+Math.random()*.3,b.decayTime=.1+Math.random()*.2,Math.random()<.5&&(b.hpFilterCutoff=Math.random()*.3),Math.random()<.5&&(b.lpFilterCutoff=1-Math.random()*.6),a(b)},generateBlipSelect:()=>{let b=Object.assign({},defaultSynth);return b.waveType=Math.floor(Math.random()*2),b.waveType==0&&(b.squareDuty=Math.random()*.6),b.startFrequency=.2+Math.random()*.4,b.sustainTime=.1+Math.random()*.1,b.decayTime=Math.random()*.2,b.hpFilterCutoff=.1,a(b)}}})(),m=(a,b,c,d)=>((Math.atan2(d-b,c-a))*180/Math.PI),n=(c,d,a,b)=>(Math.sqrt((a-=c)*a+(b-=d)*b)),o=(a,b)=>((Math.cos(b*Math.PI/180))*a),q=(a,b)=>((Math.sin(b*Math.PI/180))*a),motionAdd=(a,d,e)=>{let b=o(a.e,a.d)+o(d,e);let c=q(a.e,a.d)+q(d,e);a.e=Math.hypot(b,c),a.d=m(0,0,b,c)},randomSign=()=>Math.random()>.5?-1:1,a=(a,b,c)=>{for(let d=0;d<a.elements.length;d++)a.elements[d].transform.baseVal[0].matrix.e=b,a.elements[d].transform.baseVal[0].matrix.f=c},b=(a,b,c,d)=>{for(let e=0;e<a.elements.length;e++)a.elements[e].children[0].transform.baseVal[1].setRotate(b,c,d)},createExplosion=(a,b,c)=>{playSound(c,a,b);for(let d=0;d<4;d++)ad.push({x:a+(Math.random()*20-10),y:b+(Math.random()*20-10),node:nodeCreate('explosion','.topLayer',a=>{a.children[0].style.fill=['#FD6D0A','#FE9923','#FFDE03','#fff'][Math.floor(d)]}),life:50,e:Math.random()/4,d:Math.random()*360,animate:(a,b)=>{b.children[0].r.baseVal.value=a.life/2+20,b.children[0].style.opacity=.02*a.life}})},emit=(c,d,a,b)=>{if(Math.random()>quality)return;ad.push({x:c+o(-a,b),y:d+q(-a,b),node:nodeCreate('bubbleParticle','.bottomLayer'),life:120,e:a/10,d:b-180+(Math.random()*30-15),animate:(a,b)=>{b.children[0].style.opacity=.03333333333333333*a.life}})},applyGravity=a=>{for(let b=0;b<planets.length;b++){let c=n(a.x,a.y,planets[b].x,planets[b].y);let d=m(a.x,a.y,planets[b].x,planets[b].y);motionAdd(a,1/a.mass*gravityPower*(a.mass*planets[b].mass)/(c*c),d)}},moveGameObjects=c=>{for(let d=0;d<c.length;d++)c[d].x+=o(c[d].e,c[d].d),c[d].y+=q(c[d].e,c[d].d),a(c[d].node,c[d].x,c[d].y),b(c[d].node,c[d].d,c[d].aa,c[d].ab)},moveGameObjects2=c=>{for(let d=0;d<c.length;d++){if(c[d].glitching||c[d].dead)continue;motionAdd(c[d],c[d].currentAcceleration,c[d].facing),c[d].currentAcceleration=0,c[d].e=Math.min(c[d].e,c[d].f),c[d].x+=o(c[d].e,c[d].d),c[d].y+=q(c[d].e,c[d].d),a(c[d].node,c[d].x,c[d].y),b(c[d].node,c[d].facing,c[d].aa,c[d].ab)}},destroy=(a,b)=>{nodeDestroy(a[b].node),a.splice(b,1)},nodes={},nodeCreate=(a,e,d)=>{if(nodes[a]||(nodes[a]=[]),!nodes[a].length){let c=[];for(let f=0;f<panes.length;f++){let g=window[a].cloneNode(!0);g.id='',c.push(g),panes[f].querySelector(e).appendChild(g)}nodes[a].push({baseNode:a,elements:c})}let b=nodes[a].pop();for(let f=0;f<b.elements.length;f++)b.elements[f].style.display='',b.elements[f].style.opacity=1,d&&d(b.elements[f],f);return b},nodeDestroy=a=>{for(let b=0;b<a.elements.length;b++)a.elements[b].style.display='none';nodes[a.baseNode].push(a)},checkCollisions=(a,b)=>{if(a.dead)return;for(let c=0;c<b.length;c++){if(a.owner&&a.owner.id==b[c].id)continue;if(collisionDistance=n(a.x,a.y,b[c].x,b[c].y),collisionDistance<a.collisionRadius+b[c].collisionRadius){if(a.life=0,b[c].life-=a.damage,b[c].type==='cpu')for(let c=0;c<players.length;c++)players[c].id===a.owner.id&&(players[c].points++,split||(killCount.innerText=players[c].points));break}}},buttonMoveDown=!1,buttonShootDown=!1,buttonTurnLeftDown=!1,buttonTurnRightDown=!1,buttonGlitchDown=!1,document.body.onkeydown=a=>{a.which==38&&(buttonMoveDown=!0),a.which==37&&(buttonTurnLeftDown=!0),a.which==39&&(buttonTurnRightDown=!0),a.which==17&&(buttonShootDown=!0),a.which==16&&(buttonGlitchDown=!0)},document.body.onkeyup=a=>{a.which==38&&(buttonMoveDown=!1),a.which==37&&(buttonTurnLeftDown=!1),a.which==39&&(buttonTurnRightDown=!1),a.which==17&&(buttonShootDown=!1),a.which==16&&(buttonGlitchDown=!1)},controlKeyboardUpdate=a=>{buttonMoveDown&&(players[a].currentAcceleration=players[a].l),buttonTurnLeftDown?players[a].g=Math.max(players[a].g-players[a].k,-players[a].h):buttonTurnRightDown?players[a].g=Math.min(players[a].g+players[a].k,players[a].h):players[a].g/=players[a].turnFriction,buttonGlitchDown&&(players[a].glitch=!0),buttonShootDown&&(players[a].shoot=!0)},controlGamepadUpdate=(c,b)=>{let a=navigator.getGamepads();if(!a[b])return;a[b].buttons[0].pressed&&(players[c].shoot=!0),a[b].buttons[2].pressed&&(players[c].glitch=!0),a[b].buttons[7].value>.2&&(players[c].currentAcceleration=a[b].buttons[7].value*players[c].l),a[b].axes[0]>.3||a[b].axes[0]<-.3?players[c].g=Math.round(a[b].axes[0]*players[c].h):players[c].g/=players[c].turnFriction,a[b].buttons[6].pressed&&(zoom+=.1,zoom=Math.min(10,zoom)),a[b].buttons[4].pressed&&(zoom-=.1,zoom=Math.max(.1,zoom))},ai=a=>{closestPlayer=0,closestPlayerDistance=0;for(let b=0;b<players.length;b++)playerDisatance=n(a.x,a.y,players[b].x,players[b].y),(!closestPlayer||closestPlayerDistance>playerDisatance)&&(closestPlayer=players[b],closestPlayerDistance=playerDisatance);Math.random()<.8?(a.currentAcceleration=a.l,u=(a.facing-m(a.x,a.y,closestPlayer.x,closestPlayer.y)+360)%360,closestPlayerDistance<800&&(u=-u+360),closestPlayerDistance<400&&Math.random()<.2&&(a.glitch=!0),u<180?u>3?a.g=Math.max(a.g-a.k,-a.h):(closestPlayerDistance<1e3&&(a.shoot=!0),a.g/=1.2):u>180&&(u<357?a.g=Math.min(a.g+a.k,a.h):(closestPlayerDistance<1e3&&(a.shoot=!0),a.g/=1.2))):(a.currentAccelleration=0,a.g/=1.2)},startTimer=null,startCountDown=0,playerJoined={},stateStartInit=()=>{svgStartNode.style.display='block',svgDeadNode.style.display='none',state=stateStart},countDown=()=>{startCountDown--,startCountDown<=0?stateGameInit():(startText.textContent=startCountDown,startTimer=setTimeout(countDown,500))},stateStart=()=>{buttonShootDown&&!playerJoined.keyboard&&(playerJoined.keyboard=!0,playerInputs.push([controlKeyboardUpdate]),startTimer&&clearTimeout(startTimer),startText.classList.remove('blink'),split&&playerInputs.length<2?startText.textContent='Waiting for w 2':(startCountDown=3,startText.textContent=startCountDown,startTimer=setTimeout(countDown,500)));let a=navigator.getGamepads();for(let b=0;b<a.length;b++){if(!a[b])continue;for(let c=0;c<a[b].buttons.length;c++)a[b]&&a[b].buttons[c].pressed&&!playerJoined['gamepad'+b]&&(playerJoined['gamepad'+b]=!0,playerInputs.push([controlGamepadUpdate,b]),startTimer&&clearTimeout(startTimer),split&&playerInputs.length<2?startText.textContent='Waiting for w 2':(startText.classList.remove('blink'),startCountDown=3,startText.textContent=startCountDown,startTimer=setTimeout(countDown,500)))}},stateGameInit=()=>{svgStartNode.style.display='none',svgDeadNode.style.display='none',state=stateGame,createSolarSystem(solarSystemData),playerInputs.forEach(()=>{createPlayer({ah:5})}),split||(hudLayerBottom.style.display='block',updateTimeElapsed(),killCount.innerText=elapsedTime.innetText='0',createHud(hudData,players[0])),t(0,!0)},stateGame=()=>{for(let b=0;b<planets.length;b++){planets[b].angle+=planets[b].orbitSpeed,planets[b].x=o(planets[b].distance,planets[b].angle),planets[b].y=q(planets[b].distance,planets[b].angle),a(planets[b].node,planets[b].x,planets[b].y);for(let a=0;a<planets[b].node.elements.length;a++)planets[b].node.elements[a].children[planets[b].node.elements[a].children.length-1].transform.baseVal[0].setRotate(m(0,0,planets[b].x,planets[b].y),0,0)}for(let a=0;a<players.length;a++){if(checkCollisions(players[a],planets),players[a].life>0){applyGravity(players[a]),playerInputs[a][0](a,playerInputs[a][1]),updatePlayer(players[a]),players[a].life>0&&(players[a].life+=.005,players[a].life>players[a].lifeMax&&(players[a].life=players[a].lifeMax),players[a].glitchCharge+=.2,players[a].glitchCharge>players[a].glitchMax&&(players[a].glitchCharge=players[a].glitchMax));let b=9999999;let c=null;for(let d=0;d<players.length;d++){if(a===d)continue;let e=n(players[a].x,players[a].y,players[d].x,players[d].y);e<b&&(b=e,c=players[d])}for(let d=0;d<cpus.length;d++){let e=n(players[a].x,players[a].y,cpus[d].x,cpus[d].y);e<b&&(b=e,c=cpus[d])}let d=players[a].node.elements[a].children[1].children[0];if(c!==null){let e=m(players[a].x,players[a].y,c.x,c.y);b/=20,b<70?b=70:b>200&&(b=200),d.transform.baseVal[0].matrix.e=o(b,e-90),d.transform.baseVal[0].matrix.f=q(b,e-90),d.children[0].transform.baseVal[0].setRotate(e-90,0,0),d.style.display=''}else d.style.display='none';split||(updateHud(players[a],players[a].life,players[a].lifeMax,'life'),updateHud(players[a],players[a].glitchCharge,players[a].glitchMax,'glitch'))}else{if(!players[a].dead){createExplosion(players[a].x,players[a].y,players[a].explosionSound),players[a].dead=!0;for(let b=0;b<players[a].node.elements.length;b++)players[a].node.elements[b].style.display='none'}split||destroy(players,a)}if(split&&players[a].dead&&(players[a].life--,players[a].life<-100)){players[a].dead=!1;for(let b=0;b<players[a].node.elements.length;b++)players[a].node.elements[b].style.display='';players[a].life=players[a].lifeMax,players[a].e=0,spawnPlayer(players[a])}}for(let a=0;a<cpus.length;a++)checkCollisions(cpus[a],planets),cpus[a].life>0?(applyGravity(cpus[a]),ai(cpus[a]),updatePlayer(cpus[a]),cpus[a].glitchCharge+=.2,cpus[a].glitchCharge>cpus[a].glitchMax&&(cpus[a].glitchCharge=cpus[a].glitchMax)):(createExplosion(cpus[a].x,cpus[a].y,cpus[a].explosionSound),destroy(cpus,a));for(let d=0;d<glitches.length;d++){if(glitches[d].delay!==null&&glitches[d].delay--<0){let c=glitches[d].glitchLog[0];for(let a=0;a<30;a++)ad.push({x:c[0]+o(Math.random()*50-25,c[2]),y:c[1]+q(Math.random()*50-25,c[2]),node:nodeCreate('glitchParticle','.glitchLayer',a=>{a.children[0].style.fill=['#9417FF','#5A30CC','#9417FF','#fff'][Math.floor(Math.random()*4)],a.children[0].style.opacity=Math.random(),a.children[0].transform.baseVal[0].setRotate(c[2],0,0),a.children[0].transform.baseVal[1].setScale(1,1)}),life:100,e:Math.random()*2,d:a%2==0?c[2]+90:c[2]-90,animate:(a,b)=>{b.children[0].transform.baseVal[1].setScale(.02*a.life,.02*a.life),b.children[0].style.opacity=.02*a.life}});glitches[d].delay=null;for(let a=0;a<glitches[d].node.elements.length;a++)glitches[d].node.elements[a].style.display=''}if(glitches[d].delay===null){let c=glitches[d].glitchLog.shift();if(a(glitches[d].node,c[0],c[1]),b(glitches[d].node,c[2],glitches[d].aa,glitches[d].ab),c[3]>.1&&emit(c[0],c[1],25,c[2]),c[4]&&(playSound(glitches[d].owner.shootSound,c[0],c[1]),bullets.push({owner:glitches[d].owner,node:nodeCreate('bullet','.bottomLayer'),aa:0,ab:0,x:c[0]+o(glitches[d].owner.gunMounts[c[5]],c[2]+90),y:c[1]+q(glitches[d].owner.gunMounts[c[5]],c[2]+90),d:c[2],e:30,life:60,mass:.8,collisionRadius:10,damage:1})),!glitches[d].glitchLog.length){for(let a=0;a<30;a++)ad.push({x:c[0]+o(Math.random()*50-25,c[2]),y:c[1]+q(Math.random()*50-25,c[2]),node:nodeCreate('glitchParticle','.glitchLayer',a=>{a.children[0].style.fill=['#9417FF','#5A30CC','#9417FF','#fff'][Math.floor(Math.random()*4)],a.children[0].style.opacity=Math.random(),a.children[0].transform.baseVal[0].setRotate(c[2],0,0),a.children[0].transform.baseVal[1].setScale(1,1)}),life:100,e:Math.random()*2,d:a%2==0?c[2]+90:c[2]-90,animate:(a,b)=>{b.children[0].transform.baseVal[1].setScale(.02*a.life,.02*a.life),b.children[0].style.opacity=.02*a.life}});destroy(glitches,d)}}}moveGameObjects2(players),moveGameObjects2(cpus),moveGameObjects(bullets);for(let a=0;a<bullets.length;a++)applyGravity(bullets[a]),checkCollisions(bullets[a],players),checkCollisions(bullets[a],cpus),checkCollisions(bullets[a],planets),bullets[a].life<=0&&(bullets[a].explode=!0),bullets[a].life--,bullets[a].life<=0&&(bullets[a].explode&&createExplosion(bullets[a].x,bullets[a].y,bullets[a].owner.explosionSound),destroy(bullets,a));for(let b=0;b<ad.length;b++){ad[b].x+=o(ad[b].e,ad[b].d),ad[b].y+=q(ad[b].e,ad[b].d);for(let a=0;a<ad[b].node.elements.length;a++)ad[b].animate(ad[b],ad[b].node.elements[a]);a(ad[b].node,ad[b].x,ad[b].y),ad[b].life--,ad[b].life<0&&destroy(ad,b)}for(let a=0;a<panes.length;a++)players[a]&&(panes[a].viewBox.baseVal.x=players[a].x-window.innerWidth*zoom/2,panes[a].viewBox.baseVal.y=players[a].y-window.innerHeight*zoom/2,panes[a].viewBox.baseVal.width=window.innerWidth*zoom,panes[a].viewBox.baseVal.height=window.innerHeight*zoom);if(playerInputs.length===1&&players[0])while(cpus.length<players[0].points/3+1)createCpu({lifeMax:1});split||players.length||stateDeadInit()},stateDeadInit=()=>{svgStartNode.style.display='none',svgDeadNode.style.display='block',state=stateDead,timeElapsedID&&(clearInterval(timeElapsedID),timeElapsedID=!1,timeElapsed=0);while(players.length)destroy(players,0);while(cpus.length)destroy(cpus,0);while(ad.length)destroy(ad,0);while(bullets.length)destroy(bullets,0);while(glitches.length)destroy(glitches,0);while(planets.length)destroy(planets,0);while(hudLayer.firstChild)hudLayer.removeChild(hudLayer.firstChild);canRestart=!1,setTimeout(()=>{canRestart=!0},2e3)},stateDead=()=>{if(!canRestart)return;buttonShootDown&&location.reload();let a=navigator.getGamepads();for(let b=0;b<a.length;b++){if(!a[b])continue;for(let c=0;c<a[b].buttons.length;c++)a[b]&&a[b].buttons[c].pressed&&location.reload()}},bullets=[],cpus=[],glitches=[],gravityPower=2500,low=location.search.indexOf('low')!==-1,planets=[],players=[],playerInputs=[],ad=[],quality=low?.1:1,split=location.search.indexOf('split')!==-1,timeElapsed=0,timeElapsedID=!1,zoom=2,glitchColors={human:['#9417FF','#5A30CC','#9417FF','#fff'],cpu:['#e0421d','#ed4559','#e0421d','#fff']},setGameState=(a,b)=>{split=a,low=b,location=(split?'?split,':'?cpu,')+(low?'low':'high')},updateLinkClass=(b,c)=>{els=document.getElementsByClassName(b);for(var a=0;a<els.length;a++)els[a].className+=c},updateButtons=()=>{c=location.search.substr(1).split(',');for(var a=0;a<c.length;++a)updateLinkClass(c[a],' active')},updateTimeElapsed=()=>{timeElapsedID=setInterval(()=>{elapsedTime.innerText=++timeElapsed},1e3)},split?panes=[document.querySelector('.splitLeft'),document.querySelector('.splitRight')]:(panes=[document.querySelector('.splitLeft')],panes[0].style.width='100vw'),createNodes=(a,b,c)=>{for(let d=0;d<panes.length;d++)for(let d=0;d<panes.length;d++)while(a.length<1e3){let e=b.cloneNode(!0);e.id='',panes[d].querySelector(c).appendChild(e),a.push(e)}},createSolarSystem=()=>{let a=['sunStar','planetOrange','planetBlue','planetGrey','planetOrange','planetBlue','planetGrey'];for(let b=0;b<a.length;b++){let c=b>0?Math.random()+.5:3;let d={node:nodeCreate(a[b],'.planetLayer',a=>{a.transform.baseVal[1].setScale(c,c)}),distance:1e3*b,angle:Math.random()*360,scale:c,mass:c*10,collisionRadius:c*100,orbitSpeed:.1-1e-5*(300*b)};planets.push(d)}},solarSystemData={stars:{count:2e3*quality,field:{width:window.innerWidth*15,height:window.innerHeight*15}}};for(let a=0;a<panes.length;a++)for(let c=0;c<solarSystemData.stars.count;c++){let b=starNode.cloneNode(!0);b.id='',b.r.baseVal.value=Math.random()*5,b.cx.baseVal.value=solarSystemData.stars.field.width*2*Math.random()-solarSystemData.stars.field.width,b.cy.baseVal.value=solarSystemData.stars.field.height*2*Math.random()-solarSystemData.stars.field.height,b.style.opacity=Math.random(),b.style.fill='#c0f7ff',Math.random()<=.5?b.style.fill='#fff':Math.random()<=.5&&(b.style.fill='#fffec4'),panes[a].querySelector('.stars').appendChild(b)}createPlayer=e=>{let b=0,c=0,d;do{d=9999999,b+=Math.random()*1e4-5e3,c+=Math.random()*1e4-5e3;for(let f=0;f<planets.length;f++){let g=Math.abs(n(b,c,o(planets[f].distance,planets[f].angle),q(planets[f].distance,planets[f].angle)));g<d&&(d=g)}}while(d<1e3);let a={id:Math.floor(Math.random()*1e6),type:'human',node:nodeCreate('boatWrapper','.topLayer',(a,b)=>{b!==players.length&&(a.children[1].style.display='none')}),aa:33.5,ab:26.5,hud:{},life:split?10:20,lifeMax:split?10:20,glitch:!1,glitchCharge:0,glitchMax:20,glitchLog:[],glitchReloadTime:30,glitchReloading:30,glitching:!1,shootSound:createSound(soundGenerator.generateLaserShoot()),glitchSound:createSound(soundGenerator.generateJump()),explosionSound:createSound(soundGenerator.generateHitHurt()),x:b,y:c,d:0,facing:0,e:0,mass:1,collisionRadius:30,f:15,l:.4,friction:1.1,g:0,h:5,k:.5,turnFriction:1.2,currentAcceleration:0,shoot:!1,ag:0,ah:10,gunMount:0,gunMounts:[20,-20],points:0};for(let f in e)a[f]=e[f];a.life=a.lifeMax,players.push(a)},createCpu=a=>{createPlayer(a),cpuPlayer=players.pop(),cpuPlayer.type='cpu',cpuPlayer.node.elements[0].classList='player2',cpus.push(cpuPlayer)},spawnPlayer=d=>{let b=0,c=0,a;do{a=9999999,b+=Math.random()*200-100,c+=Math.random()*200-100;for(let e=0;e<planets.length;e++){let f=Math.abs(n(b,c,o(planets[e].distance,planets[e].angle),q(planets[e].distance,planets[e].angle)));f<a&&(a=f)}for(let e=0;e<players.length;e++){let f=Math.abs(n(b,c,players[e].x,players[e].y));f<a&&(a=f)}for(let e=0;e<cpus.length;e++){let f=Math.abs(n(b,c,cpus[e].x,cpus[e].y));f<a&&(a=f)}for(let e=0;e<glitches.length;e++){let f=Math.abs(n(b,c,glitches[e].glitchLog[0][0],glitches[e].glitchLog[0][1]));f<a&&(a=f)}}while(a<700);d.x=b,d.y=c},updatePlayer=a=>{a.facing+=a.g;while(a.facing>360)a.facing-=360;while(a.facing<0)a.facing+=360;if(a.currentAcceleration>.1&&!a.glitching&&emit(a.x,a.y,25,a.facing),a.glitch&&a.glitchReloading<0&&a.glitchCharge>=a.glitchMax){for(let b=0;b<30;b++)ad.push({x:a.x+o(Math.random()*50-25,a.facing),y:a.y+q(Math.random()*50-25,a.facing),node:nodeCreate('glitchParticle','.glitchLayer',b=>{b.children[0].style.fill=glitchColors[a.type][Math.floor(Math.random()*4)],b.children[0].style.opacity=Math.random(),b.children[0].transform.baseVal[0].setRotate(a.facing,0,0),b.children[0].transform.baseVal[1].setScale(1,1)}),life:100,e:Math.random()*2,d:b%2==0?a.facing+90:a.facing-90,animate:(a,b)=>{b.children[0].transform.baseVal[1].setScale(.02*a.life,.02*a.life),b.children[0].style.opacity=.02*a.life}});playSound(a.glitchSound,a.x,a.y),a.glitchCharge=0,a.glitching=!0,a.glitchReloading=a.glitchReloadTime;for(let b=0;b<a.node.elements.length;b++)a.node.elements[b].style.display='none';a.e=0}if(a.glitching&&a.glitchReloading<0){a.glitching=!1;for(let b=0;b<a.node.elements.length;b++)a.node.elements[b].style.display='';glitches.push({owner:a,node:nodeCreate('boatWrapper','.topLayer',b=>{b.style.display='none',b.children[1].children[0].style.display='none',a.type==='cpu'&&(b.classList='player2')}),aa:33.5,ab:26.5,delay:Math.random()*100,glitchLog:a.glitchLog}),a.glitchLog=[],spawnPlayer(a)}a.glitching||a.glitchLog.push([a.x,a.y,a.facing,a.currentAcceleration,a.shoot&&a.ag<0&&!a.glitching,a.gunMount]),a.shoot&&a.ag<0&&!a.glitching&&(playSound(a.shootSound,a.x,a.y),a.ag=a.ah,bullets.push({owner:a,node:nodeCreate('bullet','.bottomLayer'),aa:0,ab:0,x:a.x+o(a.gunMounts[a.gunMount],a.facing+90),y:a.y+q(a.gunMounts[a.gunMount],a.facing+90),d:a.facing,e:30,life:60,mass:.8,collisionRadius:10,damage:1}),a.gunMount++,a.gunMount>=a.gunMounts.length&&(a.gunMount=0)),a.glitchReloading--,a.glitch=!1,a.ag--,a.shoot=!1},createHud=(b,c)=>{for(let d=0;d<b.length;d++){let e=hud.cloneNode(!0);if(e.id='hud'+b[d].id.charAt(0).toUpperCase()+b[d].id.substr(1).toLowerCase(),hScale=window.innerWidth/900*.1+.5,e.transform.baseVal[1].setScale(hScale,hScale),b[d].hasOwnProperty('hAlign')&&b[d].hAlign==='right'){e.setAttributeNS(null,'class','hudRight');let g=e.children[0].children[0];let h=436;g.transform.baseVal[1].setScale(-1,1),a({elements:[g]},h,0),a({elements:[e.children[0].children[1]]},h-112,76)}let f=e.children[1];e.children[0].children[1].innerHTML=b[d].text;for(let a=0;a<c.lifeMax;a++){let e=a==0?f.children[0]:f.children[0].cloneNode(!0);e.setAttributeNS(null,'x',a*b[d].bars.offset),a>=c[b[d].id]&&e.setAttributeNS(null,'class','hudBar hudBarE'),f.appendChild(e)}e.style.display='',hudLayer.appendChild(e),c.hud[b[d].id]={data:b[d],element:hudLayer.children[hudLayer.children.length-1]}}},updateHud=(a,c,e,b)=>{if(c>=0&&c<=e){let d='hudBar';for(let f=0;f<a.hud[b].element.children[1].children.length;f++){f>=c&&(d+=' hudBarE');let g=a.hud[b].data.hAlign==='right'?a.hud[b].element.children[1].children.length-(f+1):f;a.hud[b].element.children[1].children[g].classList=d}}},hudData=[{id:'glitch',hAlign:'right',bars:{width:16,offset:22},text:'GLITCH'},{id:'life',bars:{width:16,offset:22},text:'HEALTH'}],t=(b,a)=>{state(),a!==!0&&requestAnimationFrame(t)},stateStartInit(),updateButtons(),t()